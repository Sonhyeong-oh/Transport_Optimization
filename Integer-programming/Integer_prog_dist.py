import torch
import numpy as np
from pulp import *
import random
import time
from itertools import combinations
import Integer_prog_dist_function as ipf

num_clusters = 4 # í´ëŸ¬ìŠ¤í„° ìˆ˜
max_solutions = 10 # íƒìƒ‰í•  ìµœëŒ€ í•´ì˜ ìˆ˜
timeout_per_solution = 60 # ê° í•´ë‹¹ ì°¾ê¸° ì‹œê°„ ì œí•œ (ì´ˆ ë‹¨ìœ„)


# ì‹¤í–‰ ì˜ˆì œ
# ë°ì´í„° ì„¤ì •
fixed_net_demand = torch.tensor([
    [  3, -4,  2], [ -2,  3, -1], [  4,  1, -3],
    [ -3, -2,  4], [  2,  5, -2], [ -1, -3,  3],
    [  5,  2, -4], [ -4,  1,  5], [  1, -1, -3],
    [ -2,  4,  2], [  3, -5,  1], [ -5,  3, -2],
    [  2, -2,  3], [ -1,  1, -1], [  4, -3, -5],
    [ -3,  2,  4], [ -2, -1,  2], [ -1, -1, -5] 
], dtype=torch.float32)

dist_matrix = torch.tensor([
    [0,   84,  160, 200, 222, 108, 209, 38,  61,  150, 119, 148, 78,  30,  44,  82,  116, 114],
    [84,  0,   127, 166, 141, 181, 175, 60,  20,  72,  70,  123, 156, 112, 122, 112, 202, 158],
    [160, 127, 0,   47,  99,  65,  59,  134, 107, 117, 90,  68,  243, 187, 128, 110, 96,  53 ],
    [200, 166, 47,  0,   54,  104, 14,  173, 146, 114, 129, 76,  282, 227, 168, 150, 136, 89 ],
    [222, 141, 99,  54,  0,   164, 47,  189, 159, 64,  84,  52,  287, 249, 216, 198, 185, 142],
    [108, 181, 65,  104, 164, 0,   118, 105, 138, 171, 144, 138, 221, 118, 67,  50,  25,  17 ],
    [209, 175, 59,  14,  47,  118, 0,   184, 159, 108, 107, 78,  293, 237, 178, 160, 147, 102],
    [38,  60,  134, 173, 189, 105, 184, 0,   34,  124, 87,  116, 123, 65,  64,  54,  109, 90 ],
    [61,  20,  107, 146, 159, 138, 159, 34,  0,   95,  55,  85,  145, 87,  97,  83,  178, 119],
    [150, 72,  117, 114, 64,  171, 108, 124, 95,  0,   29,  52,  224, 187, 197, 186, 199, 151],
    [119, 70,  90,  129, 84,  144, 107, 87,  55,  29,  0,   31,  211, 143, 150, 128, 171, 124],
    [148, 123, 68,  76,  52,  138, 78,  116, 85,  52,  31,  0,   262, 220, 197, 142, 166, 118],
    [78,  156, 243, 282, 287, 221, 293, 123, 145, 224, 211, 262, 0,   61,  119, 149, 192, 211],
    [30,  112, 187, 227, 249, 118, 237, 65,  87,  187, 143, 220, 61,  0,   44,  73,  155, 143],
    [44,  122, 128, 168, 216, 67,  178, 64,  97,  197, 150, 197, 119, 44,  0,   31,  75,  74 ],
    [82,  112, 110, 150, 198, 50,  160, 54,  83,  186, 128, 142, 149, 73,  31,  0,   57,  55 ],
    [116, 202, 96,  136, 185, 25,  147, 109, 178, 199, 171, 166, 192, 155, 75,  57,  0,   43 ],
    [114, 158, 53,  89,  142, 17,  102, 90,  119, 151, 124, 118, 211, 143, 74,  55,  43,  0  ]
], dtype=torch.float32)

city_names = ['ì¶˜ì²œ', 'ì›ì£¼', 'ê°•ë¦‰', 'ë™í•´', 'íƒœë°±', 'ì†ì´ˆ', 'ì‚¼ì²™', 'í™ì²œ', 
             'íš¡ì„±', 'ì˜ì›”', 'í‰ì°½', 'ì •ì„ ', 'ì² ì›', 'í™”ì²œ', 'ì–‘êµ¬', 'ì¸ì œ', 'ê³ ì„±', 'ì–‘ì–‘']

print("ğŸ¯ ê±°ë¦¬ ìµœì í™” ê¸°ë°˜ í•´ ì„ íƒ ì‹œì‘...")
print("ğŸ“Œ ë°©ì‹: ê° í´ëŸ¬ìŠ¤í„°ì˜ ì´ ê±°ë¦¬ë¥¼ êµ¬í•˜ê³ , ê·¸ í‰ê· ì´ ê°€ì¥ ì‘ì€ í•´ë¥¼ ì„ íƒ")

# ì—¬ëŸ¬ í•´ íƒìƒ‰ ë° ìµœì  ê±°ë¦¬ í•´ ì„ íƒ
best_result, all_solutions = ipf.solve_multiple_solutions_with_distance_selection(
    fixed_net_demand, dist_matrix, 
    num_clusters=num_clusters, 
    max_solutions=max_solutions,  # 5ê°œ í•´ íƒìƒ‰
    timeout_per_solution=timeout_per_solution  # ê° í•´ë‹¹ 60ì´ˆ ì œí•œ
)

if best_result:
    ipf.print_distance_comparison_results(best_result, all_solutions, num_clusters, city_names)
else:
    print("âŒ í•´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
